<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Recuperar contraseña - Digital Point</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body class="register-body">
  <div class="forgot-box">
    <h2>Recuperar contraseña</h2>

    <div id="step-email">
      <p>Ingresa tu correo para recibir un código temporal (simulado)</p>
      <form onsubmit="return solicitarCodigo();">
        <input type="email" id="email-reset" placeholder="correo@digitalpoint.com" required />
        <button class="btn" type="submit">Enviar código</button>
      </form>
      <p><a href="login.html">Volver al inicio</a></p>
    </div>

    <div id="step-verify" style="display:none;">
      <p>Introduce el código y la nueva contraseña.</p>
      <form onsubmit="return verificarYCambiar();">
        <input type="text" id="codigo-input" placeholder="Código de 6 dígitos" required />
        <input type="password" id="new-password" placeholder="Nueva contraseña" required />
        <input type="password" id="confirm-password" placeholder="Confirmar contraseña" required />
        <button class="btn" type="submit">Cambiar contraseña</button>
      </form>
      <p><a href="login.html">Volver al inicio</a></p>
    </div>
  </div>

  <script>
    function generarCodigo() {
      return Math.floor(100000 + Math.random() * 900000).toString();
    }

    function solicitarCodigo() {
      const email = document.getElementById('email-reset').value.trim();
      const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
      if (!usuarios.find(u => u.correo === email)) {
        alert('No existe un usuario con ese correo');
        return false;
      }
      const codigo = generarCodigo();
      localStorage.setItem(`resetCode_${email}`, codigo);
      localStorage.setItem('resetEmailTemp', email);
      alert('Código simulado: ' + codigo);
      document.getElementById('step-email').style.display = 'none';
      document.getElementById('step-verify').style.display = 'block';
      return false;
    }

    function verificarYCambiar() {
      const codigoIngresado = document.getElementById('codigo-input').value.trim();
      const newPassword = document.getElementById('new-password').value;
      const confirm = document.getElementById('confirm-password').value;
      const email = localStorage.getItem('resetEmailTemp');
      if (!email) { alert('Inicia el proceso de recuperación'); return false; }
      const codigoGuardado = localStorage.getItem(`resetCode_${email}`);
      if (codigoIngresado !== codigoGuardado) { alert('Código incorrecto'); return false; }
      if (newPassword.length < 6) { alert('Contraseña muy corta'); return false; }
      if (newPassword !== confirm) { alert('Las contraseñas no coinciden'); return false; }
      const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
      const idx = usuarios.findIndex(u => u.correo === email);
      if (idx === -1) { alert('Usuario no encontrado'); return false; }
      usuarios[idx].password = newPassword;
      localStorage.setItem('usuarios', JSON.stringify(usuarios));
      localStorage.removeItem(`resetCode_${email}`);
      localStorage.removeItem('resetEmailTemp');
      alert('Contraseña actualizada. Inicia sesión con tu nueva contraseña.');
      window.location.href = 'login.html';
      return false;
    }
  </script>
</body>
</html>
